<!DOCTYPE html>
<html>
    <head>
        <title>Offline checker</title>
        <meta chrset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>
    <body>
        <h1 id="header"></h1>
        <button id="pingButton" onclick="onPing();">PING</button>
        <p id="logs"></p>
        <script>
            const header = document.querySelector("#header");
            const logs = document.querySelector("#logs");
            const pingButton = document.querySelector("#pingButton");

            const log = (message) => {
                logs.innerHTML += `${new Date().toLocaleString()} â€” ${message}<br />`;
            };

            const onPing = () => {
                pingButton.disabled = true;
                fetch("https://800147.github.io/offline-checker/ping.txt")
                    .then((res) => {
                        log(`ping: ${res.status} ${res.statusText}`);
                    })
                    .catch((error) => {
                        log(`ping error: ${error}`);
                    })
                    .finally(() => {
                        pingButton.disabled = false;
                    });
            };

            const handler = () => {
                const status = window.navigator.onLine
                    ? '<span style="color: green;">ONLINE</span>'
                    : '<span style="color: red;">OFFLINE</span>';

                header.innerHTML = status;
                log(status);
            };

            window.addEventListener("online", handler);
            window.addEventListener("offline", handler);

            handler();
        </script>
    </body>
</html>
